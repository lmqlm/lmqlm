/**
檢查各種資料是否符合規定相關之共用函式
*/

var CheckInput = new Object();

/**
檢查區塊內欄位是否空白
@param blockName 區塊名稱
*/
CheckInput.validBlockNull	=	function (blockName) {
    var bChk = true;
    var first = true;
    var s = '';
    var formObj = document.forms[0];
    for (var i = 0; i < formObj.length; i++) {
        inputObj = formObj.elements[i];
        var tmp = inputObj.name.split('$');
        var objName = tmp[tmp.length - 1];
        if (objName.substring(0, 2) != blockName) {
            continue;
        }

        if ($("[id$=" + inputObj.id + "]").attr("MYVALID") == 'NotNull') {
            var value = "";
            //增加判斷RadioButtonList必填
            if ($(inputObj).prop('type') == "radio") {
                var radioId = inputObj.id.substring(0, inputObj.id.lastIndexOf("_"));
                value = $("input[name=" + radioId + "]:checked").val();
            } else {
                value = inputObj.value;
            };

            if (value == '' || value == undefined) {
                if (first) {
                    inputObj.focus();
                    first = false;
                }
                bChk = false;
                var CNAME = $("[id$=" + inputObj.id + "]").attr("CNAME");
                if (typeof (CNAME) == "undefined") {
                    CNAME = "";
                }
                s += "[" + CNAME + "]欄位不可空白!!\n";
            }
        }
    }
    return s;
}

/*
判斷輸入格式為英文+數字
*/
CheckInput.CheckEngInt	=	function (obj) {
    if (obj.value.length > 0 ){
        re = /\W/;
        if (re.test(obj.value)){
            var name = $("[id$=" + obj.id + "]").attr("CNAME");
            if (isset(name)) {
                name = "[" + name + "]";
            }else{
                name = "";
            }
            alert(name + " 英文或數字格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}

/*
判斷輸入格式為英文
*/
CheckInput.CheckEng	=	function (obj) {
    if (obj.value.length > 0 ){
        re = /[^a-zA-Z]/;
        if (re.test(obj.value)){
            var name = $("[id$=" + obj.id + "]").attr("CNAME");
            if (isset(name)) {
                name = "[" + name + "]";
            }else{
                name = "";
            }
            alert(name + " 英文格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}

/*
判斷輸入日期格式是否正確
*/
CheckInput.CheckDate	=	function (obj) {
    if (obj.value.length > 0 ){
        if (isDate(obj.value) == false) {
            var name = $("[id$=" + obj.id + "]").attr("CNAME");
            if (isset(name)) {
                name = "[" + name + "]";
            }else{
                name = "";
            }
            alert(name + " 日期格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}

/*
判斷日期格式是否正確
*/
function isDate(year, month, day){
   var dateStr;
   if(!month || !day) {
       if(month == '') {
           dateStr = year + "/1/1"
       }else if(day == '') {
           dateStr = year + '/'+ month + '/1';
       }
       else{
			if (year.search('/')==-1){
				year = year.substring(0,4) + '/' + year.substring(4,6) + '/' + year.substring(6,8);
			}
           dateStr = year.replace(/[.-]/g, '/');
       }
   }
   else{
       dateStr = year + '/'+ month + '/'+ day;
   }
   dateStr = dateStr.replace(/\/0+/g, '/');

   var accDate = new Date(dateStr);
   var tempDate = accDate.getFullYear() + "/";
   tempDate += (accDate.getMonth() + 1) + "/";
   tempDate += accDate.getDate();

   if(dateStr == tempDate) {
       return true;
   }
   return false;
}

/*
判斷輸入民國日期格式是否正確
*/
CheckInput.CheckCDate	=	function (obj) {
    if (obj.value.length > 0) {
        if (IsCDate(obj.value) == false) {
            var name = $("[id$=" + obj.id + "]").attr("CNAME");
            if (isset(name)) {
                name = "[" + name + "]";
            } else {
                name = "";
            }
            alert(name + " 民國日期格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}



/*
判斷民國日期格式是否正確
*/
function IsCDate(n) {
    // 將民國日期轉為西元日期以判斷日期是否合法
    if (n.length < 6 || n.length > 7) {
        // 長度必須為 6 或 7
        return false;
    } else if (!IsNumeric(n)) {
        // 內容必須為數字
        return false;
    } else if (n.length == 6) {
        // 若只輸入六個字元, 將年份湊足三碼
        n = '0' + n;
    }
    // 將民國年轉成西元年
    y = parseInt(n.substr(0, 3), 10) + 1911;
    m = parseInt(n.substr(3, 2), 10) - 1;
    d = parseInt(n.substr(5, 2), 10);
    // 將日期字串轉成日期物件
    var x = new Date(y, m, d);
    if (isNaN(x.getTime())) {
        // 若無法轉成日期物件表示輸入資料不合法
        return false;
    } else {
        // 若輸入內容與轉換成日期格式後的資料一致, 表示日期合法
        if (y == x.getFullYear() && m == x.getMonth() && d == x.getDate()) {
            return true;
        } else {
            return false;
        }
    }
}

/*
判斷輸入民國年月格式是否正確
*/
CheckInput.CheckYYYMM = function (obj) {
    if (obj.value.length > 0) {
        if (IsYYYMM(obj.value) == false) {
            var name = $("[id$=" + obj.id + "]").attr("CNAME");
            if (isset(name)) {
                name = "[" + name + "]";
            } else {
                name = "";
            }
            alert(name + " 民國年月格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}

/*
判斷民國年月格式是否正確
*/
function IsYYYMM(n) {
    // 將民國日期轉為西元日期以判斷日期是否合法
    if (n.length != 5) {
        // 長度必須為5
        return false;
    } else if (!IsNumeric(n)) {
        // 內容必須為數字
        return false;
    }

    // 將民國年轉成西元年
    m = parseInt(n.substr(3, 2), 10) ;
    if (m > 12) {
        return false;
    }

    return true;
}

// 判斷內容是否為數字
function IsNumeric(n) {
    return (n - 0) == n && n.length > 0;
}

/*
判斷輸入格式為整數
*/
CheckInput.CheckInt	=	function (obj) {
    if (obj.value.length > 0 ){
        re = /[^0-9]/;
        if (re.test(obj.value)){
            var name = $("[id$=" + obj.id + "]").attr("CNAME");
            if (isset(name)) {
                name = "[" + name + "]";
            }else{
                name = "";
            }
            alert(name + " 整數格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}

/*
判斷輸入格式為數字
*/
CheckInput.CheckNum	=	function (obj) {
    if (obj.value.length > 0 ){
        if (isNaN(obj.value)) {
            var name = $("[id$=" + obj.id + "]").attr("CNAME");
            if (isset(name)) {
                name = "[" + name + "]";
            }else{
                name = "";
            }
            alert(name + " 數字格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}

/*
判斷輸入格式為E-mail
*/
CheckInput.CheckEmail = function (obj) {
    if (obj.value.length > 0) {
        var name = $("[id$=" + obj.id + "]").attr("CNAME");
        if (isset(name)) {
            name = "[" + name + "]";
        } else {
            name = "";
        }
        if (obj.value.indexOf("@") == -1 || obj.value.indexOf(".") == -1 || obj.value.split('@').length > 2) {
            alert(name + " E-Mail格式錯誤 !!");
            obj.value = '';
            obj.focus();
        }
    }
}

/*
變數是否設定
 ex: isset( 'Kevin van Zonneveld' );
 */
function isset () {
    var a = arguments,
        l = a.length,        i = 0,
        undef;

    if (l === 0) {
        throw new Error('Empty isset');    }

    while (i !== l) {
        if (a[i] === undef || a[i] === null) {
            return false;        }
        i++;
    }
    return true;
}

CheckInput.CheckNotNull	=	function (obj) {
    if (obj.value.length == 0 ){
        var name = $("[id$=" + obj.id + "]").attr("CNAME");
        if (isset(name)) {
            name = "[" + name + "]";
        }else{
            name = "";
        }
        alert(name + " 欄位不可空白 !!");
        obj.value = '';
        obj.focus();
    }
}

/**
依輸入欄位設定的長度,不足長度時在資料前補零 (onblur)
@type	void
*/
CheckInput.fillZero = function (inputObj_, len) {
    try {
        //var inputObj_ = event_.srcElement;

        if (inputObj_.value == "")
            return;

        inputObj_.value = StrUtil.fillZero(inputObj_.value, len);
    }
    catch (ex) {
        throw new Error(getExceptionStr("CheckInput.fillZero", arguments, ex));
    }
}